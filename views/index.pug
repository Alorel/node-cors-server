extends layout

block css
  link(rel='stylesheet', href='/balloon.min.css')
  link(rel='stylesheet', href='/site.css')

block content
  .row
    .column
      .ui.form
        .field
          label(for= 'url') URL you want to CORS:
          input#url(type= 'url', 'data-bind' = 'textInput: inurl')
        div
          span(style={display: 'block', 'font-weight': 'bold'}) CORS this instead!
          input#out(type= 'url', 'data-bind' = 'value: outfull, visible: urlvalid', readonly)
          .ui.negative.message('data-bind' = 'visible: !urlvalid()', style = {display: 'none'}) Invalid URL
  .row
    h2.column.ui.header.centered Proxy Spec
  .row
    .column.four.wide
      h3.ui.header
        span.underdot('data-balloon' = "If the content type contains any of these substrings, the request will be rejected") Blocked Content Types
      .ui.list
        each val in denied
          .item= val
    .column.four.wide
      h3.ui.header
        span.underdot('data-balloon' = "If the content type doesn't match any of the deny rules and contains one of these substrings, the CORS request will be allowed") Allowed Content Types
      .ui.list
        each val in allowed
          .item= val
    .column.six.wide
      h3.ui.header Other Specs
      table.ui.celled.table
        tbody
          tr
            td Allowed HTTP methods
            td= methods
          tr
            td
              span.underdot('data-balloon' = 'Requests will be rejected if the content length exceeds this value') Maximum Content length
            td= maxlength
          tr
            td
              span.underdot('data-balloon' = 'Every request results in a HEAD pre-check of the target resource to perform filtering. This is how long these requests are cached for.') HEAD cache age limit
            td= head_cache_age
          tr
            td
              span.underdot('data-balloon' = 'Maximum number of HEAD requests in cache before LRU eviction takes place') HEAD cache size
            td= cache_size
  .row
    h2.column.ui.header.centered Server stats
  .row
    .column
      table.ui.celled.table
        tbody
          tr
            td System Uptime
            td(colspan=3)= system_uptime
          tr
            td Cluster ID
            td(colspan=3)= cluster
          tr
            td Cluster age
            td(colspan=3)= stats.uptime_str
          tr
            td Free memory
            td(colspan=3)= mem
          tr
            td(rowspan=2) CORS requests on this cluster since restart
            td.bold Accepted
            td.bold Rejected
            td.bold Total
          tr
            td #{stats.approved.toLocaleString()} (#{stats.approvePCT.toLocaleString()} %)
            td #{stats.rejected.toLocaleString()} (#{stats.rejectPCT.toLocaleString()} %)
            td= stats.total.toLocaleString()



block scripts
  script(src='https://cdnjs.cloudflare.com/ajax/libs/knockout/3.4.1/knockout-min.js')
  script(src='/index.js', async)